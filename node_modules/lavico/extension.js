var path = require("path") ;

var modules = [
    'user', 'map', 'survey'
] ;

module.exports = {
    onload: function(app){

	var pubpath = app.rootdir+"/node_modules/opencomb/lib/core/router/middleware/public.js" ;
	var public = require(pubpath) ;

	// 为各个模块注册 controllers/public 目录
	for(var i=0;i<modules.length;i++){

	    // public
	    app.connect.use(
                public(
                    __dirname+'/lib/'+modules[i]+'/public'
                    , '/lavico/'+modules[i]+'/public'
                )
            ) ;

	    // controllers
            app.router.regiterPublicController(__dirname+'/lib/'+modules[i]+'/controllers') ;
            app.packages.assertLookups.controller.push(function(pkg,innerPath) {
                if(pkg.name!='welab')
                    return null ;

                var pos = innerPath.lastIndexOf('/') ;
                if(pos==-1)
                    return null ;

                return pkg.folder + '/' + innerPath.substr(0,pos) + '/controllers/' + innerPath.substr(pos+1) ;
            }) ;
	}
    }
}
